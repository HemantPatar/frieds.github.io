<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97459416-1"> 
  </script>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-97459416-1');
  </script>

  <meta name="author" content="Dan Friedman">
  <meta name="geo.region" content="CA">
  <meta property="og:locale" content="en_us">
  <meta name="robot" content="all">
  <meta name="referrer" content="always">
  <meta property="fb:profile_id" content="1357771151">
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Dan Friedman's Data Science Tutorials">

  <meta property="og:see_also" content="https://twitter.com/_DanFriedman"/>
  <meta property="og:see_also" content="https://www.linkedin.com/in/danfriedman33/"/>
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@_DanFriedman">
  <meta name="twitter:image" content="https://pbs.twimg.com/profile_images/950134514113691648/7dt7ECh2_400x400.jpg" />

  <meta name="keywords" content="groupby pandas">

  <meta name="description" content="Learn how to implement a groupby in Python using pandas with simple examples">
  <meta property="og:description"  content="Learn how to implement a groupby in Python using pandas with simple examples">
  <meta name="twitter:description" content="Learn how to implement a groupby in Python using pandas with simple examples">

  <meta property="og:title" content="groupby() Method: Split Data into Groups, Apply a Function to Groups, Combine the Results">
  <meta name="twitter:title" content="groupby() Method: Split Data into Groups, Apply a Function to Groups, Combine the Results">

  <link rel="canonical" href="https://dfrieds.com/data-analysis/groupby-python-pandas"/>

  <title>groupby() Method: Split Data into Groups, Apply a Function to Groups, Combine the Results - Data Analysis</title>

  

  <!-- Latest compiled and minified Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link rel="stylesheet" href="https://dfrieds.com/theme/css/ie10-viewport-bug-workaround.css" />
  
  <!-- Custom styles for this template -->
  <link rel="stylesheet" href="https://dfrieds.com/theme/css/style.css" />
  <link rel="stylesheet" href="https://dfrieds.com/theme/css/notebooks.css" />
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800,900" rel="stylesheet">


  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <link href="https://dfrieds.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Dan Friedman's Data Science Tutorials Full Atom Feed" />    <link href="https://dfrieds.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Dan Friedman's Data Science Tutorials Full RSS Feed" />      <link href="https://dfrieds.com/feeds/data-analysis.atom.xml" type="application/atom+xml" rel="alternate" title="Dan Friedman's Data Science Tutorials Categories Atom Feed" />    <link href="https://dfrieds.com/feeds/data-analysis.rss.xml" type="application/rss+xml" rel="alternate" title="Dan Friedman's Data Science Tutorials Categories RSS Feed" />    

  <!-- Start of Async Drift Code -->
  <script>
    !function() {
      var t;
      if (t = window.driftt = window.drift = window.driftt || [], !t.init) return t.invoked ? void (window.console && console.error && console.error("Drift snippet included twice.")) : (t.invoked = !0, 
        t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
        t.factory = function(e) {
          return function() {
            var n;
            return n = Array.prototype.slice.call(arguments), n.unshift(e), t.push(n), t;
          };
        }, t.methods.forEach(function(e) {
          t[e] = t.factory(e);
        }), t.load = function(t) {
          var e, n, o, i;
          e = 3e5, i = Math.ceil(new Date() / e) * e, o = document.createElement("script"), 
          o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + i + "/" + t + ".js", 
          n = document.getElementsByTagName("script")[0], n.parentNode.insertBefore(o, n);
        });
      }();
    drift.SNIPPET_VERSION = '0.3.1';
    drift.load('83xk3ceba36c');
  </script>
  <!-- End of Async Drift Code -->


</head>

<body>
  <div class="data-analysis"></div>

  <nav class="navbar navbar-expand-sm fixed-top">
    <div class="container">
      <a class="navbar-brand" href="https://dfrieds.com/">Dan<span class="green">_</span>Friedman</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggle-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="nav navbar-nav mr-auto">
        </ul>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="https://dfrieds.com/#articles">Articles
              </a>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tutorials
              </a>
              
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="https://dfrieds.com/#python">Python</a>
                <a class="dropdown-item" href="https://dfrieds.com/#dataviz">Data Visualizations</a>
                <a class="dropdown-item" href="https://dfrieds.com/#data-analysis">Data Analysis with pandas</a>
                <a class="dropdown-item" href="https://dfrieds.com/#math">Math</a>
                <a class="dropdown-item" href="https://dfrieds.com/#ml">Machine Learning</a>
              </div>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="https://twitter.com/_DanFriedman" target="blank">Twitter</a>
                <a class="dropdown-item" href="https://github.com/frieds" target="blank">GitHub</a>
                <a class="dropdown-item" href="https://linkedin.com/in/danfriedman33" target="blank">LinkedIn</a>
              </div>
            </li>
          </ul>
      </div>
    </div>
  </nav>


  <!-- end of header section -->
  <div class="container">

<section id="content" class="body">
  <header>
    <div class="posttype"> Data Analysis Data Wrangling Tutorial</div>
    <h1 class="articleh1">
      groupby() Method: Split Data into Groups, Apply a Function to Groups, Combine the Results
    </h1>

    <ul class ="row article_info">
      
      <li>
        Nov 28&nbsp;&nbsp;&bull;&nbsp;&nbsp;15 min read
      </li>
      <li class="tagarticle">
        Key Terms:         groupby,
        python,
        pandas
      </li>
    </ul>
  </header>

  <div class='article_content'>
    <p>A <strong>group by</strong> is a process that tyipcally involves splitting the data into groups based on some criteria, applying a function to each group independently, and then combining the outputted results.</p>
<h3>Import Modules</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>


<h3>Get Tips Dataset</h3>
<p>Let's get the <code>tips</code> dataset from the <code>seaborn</code> library and assign it to the DataFrame <code>df_tips</code>.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;tips&#39;</span><span class="p">)</span>
</pre></div>


<p>Each row represents a unique meal at a restaurant for a party of people; the dataset contains the following fields:</p>
<table>
<thead>
<tr>
<th>column name</th>
<th>column description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>total_bill</code></td>
<td>financial amount of meal in U.S. dollars</td>
</tr>
<tr>
<td><code>tip</code></td>
<td>financial amount of the meal's tip in U.S. dollars</td>
</tr>
<tr>
<td><code>sex</code></td>
<td>gender of server</td>
</tr>
<tr>
<td><code>smoker</code></td>
<td>boolean to represent if server smokes or not</td>
</tr>
<tr>
<td><code>day</code></td>
<td>day of week</td>
</tr>
<tr>
<td><code>time</code></td>
<td>meal name (Lunch or Dinner)</td>
</tr>
<tr>
<td><code>size</code></td>
<td>count of people eating meal</td>
</tr>
</tbody>
</table>
<p>Preview the first 5 rows of <code>df_tips</code>. </p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.99</td>
      <td>1.01</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.34</td>
      <td>1.66</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.01</td>
      <td>3.50</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23.68</td>
      <td>3.31</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24.59</td>
      <td>3.61</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<h3>Implement Group bys with Tips Dataset</h3>
<h4>Group by of a Single Column and Apply a Single Aggregate Method on a Column</h4>
<p>The simplest example of a <code>groupby()</code> operation is to compute the size of groups in a single column. By size, the calculation is a count of unique occurences of values in a single column. Here is the <a href='https://pandas.pydata.org/pandas-docs/stable/generated/pandas.core.groupby.GroupBy.size.html'>official documentation</a> for this operation. </p>
<p>This is the same operation as utilizing the <code>value_counts()</code> method in pandas.</p>
<p>Below, for the <code>df_tips</code> DataFrame, I call the <code>groupby()</code> method, pass in the <code>sex</code> column, and then chain the <code>size()</code> method.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>sex
Male      157
Female     87
dtype: int64
</pre></div>


<p>To interpret the output above, 157 meals were served by males and 87 meals were served by females.</p>
<p>A note, if there are any <code>NaN</code> or <code>NaT</code> values in the grouped column that would appear in the index, those are automatically excluded in your output (<a href='https://pandas.pydata.org/pandas-docs/version/0.22/groupby.html#na-and-nat-group-handling'>reference here</a>). </p>
<p>In pandas, we can also group by one columm and then perform an aggregate method on a different column.</p>
<p>For example, in our dataset, I want to group by the <code>sex</code> column and then across the <code>total_bill</code> column, find the mean bill size. To do this in pandas, given our <code>df_tips</code> DataFrame, apply the <code>groupby()</code> method and pass in the <code>sex</code> column (that'll be our index), and then reference our <code>['total_bill']</code> column (that'll be our returned column) and chain the <code>mean()</code> method.</p>
<p>Meals served by males had a mean bill size of 20.74 while meals served by females had a mean bill size of 18.06.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)[</span><span class="s1">&#39;total_bill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>sex
Male      20.744076
Female    18.056897
Name: total_bill, dtype: float64
</pre></div>


<p>We can verify the output above with a query. We get the same result that meals served by males had a mean bill size of 20.74</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sex==&#39;Male&#39;&quot;</span><span class="p">)[</span><span class="s1">&#39;total_bill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>20.744076433121034
</pre></div>


<p>Another interesting tidbit with the <code>groupby()</code> method is the ability to group by a single column, and call an aggregate method that will apply to all other numeric columns in the DataFrame.</p>
<p>For example, if I group by the <code>sex</code> column and call the <code>mean()</code> method, the mean is calculated for the three other numeric columns in <code>df_tips</code> which are <code>total_bill</code>, <code>tip</code>, and <code>size</code>.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>size</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>20.744076</td>
      <td>3.089618</td>
      <td>2.630573</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>18.056897</td>
      <td>2.833448</td>
      <td>2.459770</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Aggregate Methods</h4>
<p>Other aggregate methods you could perform with a <code>groupby()</code> method in pandas are:</p>
<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sum()</code></td>
<td>summation</td>
</tr>
<tr>
<td><code>mean()</code></td>
<td>average</td>
</tr>
<tr>
<td><code>count()</code></td>
<td>count of all values</td>
</tr>
<tr>
<td><code>size()</code></td>
<td>count of non-null values</td>
</tr>
<tr>
<td><code>max()</code></td>
<td>maximum value</td>
</tr>
<tr>
<td><code>min()</code></td>
<td>minimum value</td>
</tr>
<tr>
<td><code>std()</code></td>
<td>standard deviation</td>
</tr>
<tr>
<td><code>median()</code></td>
<td>median</td>
</tr>
</tbody>
</table>
<p>To illustrate the difference between the <code>size()</code> and <code>count()</code> methods, I included this simple example below.</p>
<p>The DataFrame below of <code>df_rides</code> includes Dan and Jamie's ride data.</p>
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Dan&#39;</span><span class="p">,</span> <span class="s1">&#39;Dan&#39;</span><span class="p">,</span> <span class="s1">&#39;Jamie&#39;</span><span class="p">,</span> <span class="s1">&#39;Jamie&#39;</span><span class="p">],</span> 
        <span class="s1">&#39;ride_duration_minutes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}</span>
<span class="n">df_rides</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df_rides</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>ride_duration_minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dan</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Dan</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Jamie</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jamie</td>
      <td>10.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>For one of Dan's rides, the <code>ride_duration_minutes</code> value is null. However, if we apply the <code>size</code> method, we'll still see a count of <code>2</code> rides for Dan. We are 100% sure he took 2 rides but there's only a small issue in our dataset in which the the exact duration of one ride wasn't recorded.</p>
<div class="highlight"><pre><span></span><span class="n">df_rides</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;person&#39;</span><span class="p">)[</span><span class="s1">&#39;ride_duration_minutes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>person
Dan      2
Jamie    2
Name: ride_duration_minutes, dtype: int64
</pre></div>


<p>Upon applying the <code>count()</code> method, we only see a count of <code>1</code> for Dan because that's the number of non-null values in the <code>ride_duration_minutes</code> field that belongs to him.</p>
<div class="highlight"><pre><span></span><span class="n">df_rides</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;person&#39;</span><span class="p">)[</span><span class="s1">&#39;ride_duration_minutes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>person
Dan      1
Jamie    2
Name: ride_duration_minutes, dtype: int64
</pre></div>


<h4>Group by of a Single Column and Apply the <code>describe()</code> Method on a Single Column</h4>
<p>With grouping of a single column, you can also apply the <code>describe()</code> method to a numerical column. Below, I group by the <code>sex</code> column, reference the <code>total_bill</code> column and apply the <code>describe()</code> method on its values. The <code>describe</code> method outputs many descriptive statistics. Learn more about the <code>describe()</code> method on the official <a href='https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.describe.html'>documentation page</a>.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)[</span><span class="s1">&#39;total_bill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>157.0</td>
      <td>20.744076</td>
      <td>9.246469</td>
      <td>7.25</td>
      <td>14.00</td>
      <td>18.35</td>
      <td>24.71</td>
      <td>50.81</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>87.0</td>
      <td>18.056897</td>
      <td>8.009209</td>
      <td>3.07</td>
      <td>12.75</td>
      <td>16.40</td>
      <td>21.52</td>
      <td>44.30</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Group by of a Single Column and Apply a Lambda Expression on a Single Column</h4>
<p>Most examples in this tutorial involve using simple aggregate methods like calculating the mean, sum or a count. However, with group bys, we have flexibility to apply custom lambda functions. </p>
<p>You can learn more about lambda expressions from the <a href='https://docs.python.org/3/tutorial/controlflow.html#lambda-expressions'>Python 3 documentation</a> and about using instance methods in group bys from the <a href='https://pandas.pydata.org/pandas-docs/version/0.22/groupby.html#dispatching-to-instance-methods'>official pandas documentation</a>.</p>
<p>Below, I group by the <code>sex</code> column and apply a lambda expression to the <code>total_bill</code> column. The expression is to find the range of <code>total_bill</code> values. The range is the maximum value subtracted by the minimum value. I also rename the single column returned on output so it's understandable.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">bill</span><span class="p">:</span> <span class="n">bill</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">bill</span><span class="o">.</span><span class="n">min</span><span class="p">()})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="s2">&quot;range_total_bill&quot;</span><span class="p">})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>range_total_bill</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>43.56</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>41.23</td>
    </tr>
  </tbody>
</table>
</div>

<p>In this dataset, males had a bigger range of <code>total_bill</code> values.</p>
<h4>Group by of Multiple Columns and Apply a Single Aggregate Method on a Column</h4>
<p>We can group by multiple columns too. For example, I want to know the count of meals served by people's gender for each day of the week. So, call the <code>groupby()</code> method and set the <code>by</code> argument to a list of the columns we want to group by.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>sex     day 
Male    Thur    30
        Fri     10
        Sat     59
        Sun     58
Female  Thur    32
        Fri      9
        Sat     28
        Sun     18
dtype: int64
</pre></div>


<p>We can also group by multiple columns and apply an aggregate method on a different column. Below I group by people's gender and day of the week and find the total sum of those groups' bills.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">])[</span><span class="s1">&#39;total_bill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>sex     day 
Male    Thur     561.44
        Fri      198.57
        Sat     1227.35
        Sun     1269.46
Female  Thur     534.89
        Fri      127.31
        Sat      551.05
        Sun      357.70
Name: total_bill, dtype: float64
</pre></div>


<h4>Group by of a Single Column and Apply Multiple Aggregate Methods on a Column</h4>
<p>The <code>agg()</code> method allows us to specify multiple functions to apply to each column. Below, I group by the <code>sex</code> column and then we'll apply multiple aggregate methods to the <code>total_bill</code> column. Inside the <code>agg()</code> method, I pass a dictionary and specify <code>total_bill</code> as the key and a list of aggregate methods as the value. </p>
<p>You can pass various types of syntax inside the argument for the <code>agg()</code> method. I chose a dictionary because that syntax will be helpful when we want to apply aggregate methods to multiple columns later on in this tutorial.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">total_bill</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>sum</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>157</td>
      <td>20.744076</td>
      <td>3256.82</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>87</td>
      <td>18.056897</td>
      <td>1570.95</td>
    </tr>
  </tbody>
</table>
</div>

<p>You can learn more about the <code>agg()</code> method on the official pandas <a href='https://pandas.pydata.org/pandas-docs/stable/generated/pandas.core.groupby.DataFrameGroupBy.agg.html'>documentation page</a>.</p>
<p>The code below performs the same group by operation as above, and additionally I rename columns to have clearer names.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="s1">&#39;count_meals_served&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;average_bill_of_meal&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="s1">&#39;total_bills_of_meals&#39;</span><span class="p">})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">total_bill</th>
    </tr>
    <tr>
      <th></th>
      <th>count_meals_served</th>
      <th>average_bill_of_meal</th>
      <th>total_bills_of_meals</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>157</td>
      <td>20.744076</td>
      <td>3256.82</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>87</td>
      <td>18.056897</td>
      <td>1570.95</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can modify the format of the output above through chaining the <code>unstack()</code> and <code>reset_index()</code> methods after our group by operation. This format may be ideal for additional analysis later on.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span> <span class="s1">&#39;aggregated_column&#39;</span><span class="p">,</span> <span class="s1">&#39;level_1&#39;</span><span class="p">:</span> <span class="s1">&#39;aggregate_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="s1">&#39;grouped_column&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;aggregate_calculation&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>aggregated_column</th>
      <th>aggregate_metric</th>
      <th>grouped_column</th>
      <th>aggregate_calculation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>total_bill</td>
      <td>count</td>
      <td>Male</td>
      <td>157.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>total_bill</td>
      <td>count</td>
      <td>Female</td>
      <td>87.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>total_bill</td>
      <td>mean</td>
      <td>Male</td>
      <td>20.74</td>
    </tr>
    <tr>
      <th>3</th>
      <td>total_bill</td>
      <td>mean</td>
      <td>Female</td>
      <td>18.06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>total_bill</td>
      <td>sum</td>
      <td>Male</td>
      <td>3256.82</td>
    </tr>
    <tr>
      <th>5</th>
      <td>total_bill</td>
      <td>sum</td>
      <td>Female</td>
      <td>1570.95</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Group by of a Single Column and Apply Multiple Aggregate Methods on Multiple Columns</h4>
<p>Below, I use the <code>agg()</code> method to apply two different aggregate methods to two different columns. I group by the <code>sex</code> column and for the <code>total_bill</code> column, apply the <code>max</code> method, and for the <code>tip</code> column, apply the <code>min</code> method. </p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;total_bill&#39;</span><span class="p">:</span> <span class="s1">&#39;max_total_bill&#39;</span><span class="p">,</span> <span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="s1">&#39;min_tip_amount&#39;</span><span class="p">})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>max_total_bill</th>
      <th>min_tip_amount</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>50.81</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>44.30</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Group by of Multiple Columns and Apply a Groupwise Calculation on Multiple Columns</h4>
<p>In restaurants, common math by guests is to calculate the tip for the waiter/waittress. My mom thinks 20% tip is customary. So, if the bill was 10, you should tip 2 and pay 12 in total. I'm curious what the tip percentages are based on the gender of servers, meal and day of the week. We can perform that calculation with a <code>groupby()</code> and the <code>pipe()</code> method.</p>
<p>The <code>pipe()</code> method allows us to call functions in a <em>chain</em>. So as the <code>groupby()</code> method is called, at the same time, another function is being called to perform data manipulations. You can learn more about <code>pipe()</code> from the <a href='https://pandas.pydata.org/pandas-docs/version/0.22/groupby.html#piping-function-calls'>official documentation</a>.</p>
<p>To perform this calculation, we need to group by <code>sex</code>, <code>time</code> and <code>day</code>, then call our <code>pipe()</code> method and calculate the <code>tip</code> divided by <code>total_bill</code> multiplied by <code>100</code>.</p>
<div class="highlight"><pre><span></span><span class="n">df_tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">group</span><span class="o">.</span><span class="n">total_bill</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>sex     time    day 
Male    Lunch   Thur    15.925121
                Fri     16.686183
        Dinner  Fri     12.912840
                Sat     14.824622
                Sun     14.713343
Female  Lunch   Thur    15.388192
                Fri     19.691535
        Dinner  Thur    15.974441
                Fri     19.636618
                Sat     14.236458
                Sun     16.944367
dtype: float64
</pre></div>


<p>The highest tip percentage has been for females for dinner on Sunday.</p>
  </div>
</section>

  </div>
  
  <!-- start of footer section -->
  <footer class="footer">
    <div class="container">
      <p class="text-muted">
        <center>This project contains 70 pages and is available on <a href="https://github.com/frieds/frieds.github.io">GitHub</a>.
          <br/>
          Copyright &copy; Dan Friedman,
          <time datetime="2018">2018</time>.
        </center>
      </p>
    </div>
  </footer>

  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
  crossorigin="anonymous"></script>

  <!-- This jQuery line finds any span that contains code highlighting classes and then selects the parent <pre> tag and adds a border and background. This is done as a workaround to visually distinguish the code inputs and outputs -->
  <script>
    $( ".hll, .n, .c, .err, .k, .o, .cm, .cp, .c1, .cs, .gd, .ge, .gr, .gh, .gi, .go, .gp, .gs, .gu, .gt, .kc, .kd, .kn, .kp, .kr, .kt, .m, .s, .na, .nb, .nc, .no, .nd, .ni, .ne, .nf, .nl, .nn, .nt, .nv, .ow, .w, .mf, .mh, .mi, .mo, .sb, .sc, .sd, .s2, .se, .sh, .si, .sx, .sr, .s1, .ss, .bp, .vc, .vg, .vi, .il" ).parent( "pre" ).css( "border", "1px solid #038f6d" );
    $( ".hll, .n, .c, .err, .k, .o, .cm, .cp, .c1, .cs, .gd, .ge, .gr, .gh, .gi, .go, .gp, .gs, .gu, .gt, .kc, .kd, .kn, .kp, .kr, .kt, .m, .s, .na, .nb, .nc, .no, .nd, .ni, .ne, .nf, .nl, .nn, .nt, .nv, .ow, .w, .mf, .mh, .mi, .mo, .sb, .sc, .sd, .s2, .se, .sh, .si, .sx, .sr, .s1, .ss, .bp, .vc, .vg, .vi, .il" ).parent( "pre" ).css( "background-color", "#d6eed9" );
  </script>

  <!-- Latest compiled and minified Bootstrap JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="https://dfrieds.com/theme/js/ie10-viewport-bug-workaround.js"></script>
  <!-- <script type="text/javascript">
    $(document).on('click', 'a[href^="#"]', function (event) {
      event.preventDefault();
      $('html, body').animate({
        scrollTop: $($.attr(this, 'href')).offset().top
      }, 500);
    });
  </script> -->

</body>

</html>