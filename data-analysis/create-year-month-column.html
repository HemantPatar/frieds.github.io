<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97459416-1"> 
  </script>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-97459416-1');
  </script>

  <meta name="author" content="Dan Friedman">
  <meta name="geo.region" content="CA">
  <meta property="og:locale" content="en_us">
  <meta name="robot" content="all">
  <meta name="referrer" content="always">
  <meta property="fb:profile_id" content="1357771151">
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Dan Friedman's Data Science Knowledge Base">

  <meta property="og:see_also" content="https://twitter.com/_DanFriedman"/>
  <meta property="og:see_also" content="https://www.linkedin.com/in/danfriedman33/"/>
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@_DanFriedman">
  <meta name="twitter:image" content="https://pbs.twimg.com/profile_images/950134514113691648/7dt7ECh2_400x400.jpg" />

  <meta name="keywords" content="year month python pandas">

  <meta name="description" content="Create a new Pandas dataframe column of year-month combinations given datetime values">
  <meta property="og:description"  content="Create a new Pandas dataframe column of year-month combinations given datetime values">
  <meta name="twitter:description" content="Create a new Pandas dataframe column of year-month combinations given datetime values">

  <meta property="og:title" content="Create Year-Month Column from Dates">
  <meta name="twitter:title" content="Create Year-Month Column from Dates">

  <link rel="canonical" href="https://dfrieds.com/data-analysis/create-year-month-column"/>

  <title>Create Year-Month Column from Dates - Data Analysis</title>

  

  <!-- Latest compiled and minified Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link rel="stylesheet" href="https://dfrieds.com/theme/css/ie10-viewport-bug-workaround.css" />
  
  <!-- Custom styles for this template -->
  <link rel="stylesheet" href="https://dfrieds.com/theme/css/style.css" />

  <!--don't need this for live-->
  <!-- <link rel="stylesheet" href="theme/css/style.css"/> -->

  <link rel="stylesheet" href="https://dfrieds.com/theme/css/notebooks.css" />
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800,900" rel="stylesheet">


  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <link href="https://dfrieds.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Dan Friedman's Data Science Knowledge Base Full Atom Feed" />    <link href="https://dfrieds.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Dan Friedman's Data Science Knowledge Base Full RSS Feed" />      <link href="https://dfrieds.com/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Dan Friedman's Data Science Knowledge Base Categories Atom Feed" />    <link href="https://dfrieds.com/feeds/{slug}.rss.xml" type="application/rss+xml" rel="alternate" title="Dan Friedman's Data Science Knowledge Base Categories RSS Feed" />    

  <!-- Start of Async Drift Code -->
  <script>
    !function() {
      var t;
      if (t = window.driftt = window.drift = window.driftt || [], !t.init) return t.invoked ? void (window.console && console.error && console.error("Drift snippet included twice.")) : (t.invoked = !0, 
        t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
        t.factory = function(e) {
          return function() {
            var n;
            return n = Array.prototype.slice.call(arguments), n.unshift(e), t.push(n), t;
          };
        }, t.methods.forEach(function(e) {
          t[e] = t.factory(e);
        }), t.load = function(t) {
          var e, n, o, i;
          e = 3e5, i = Math.ceil(new Date() / e) * e, o = document.createElement("script"), 
          o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + i + "/" + t + ".js", 
          n = document.getElementsByTagName("script")[0], n.parentNode.insertBefore(o, n);
        });
      }();
    drift.SNIPPET_VERSION = '0.3.1';
    drift.load('83xk3ceba36c');
  </script>
  <!-- End of Async Drift Code -->


</head>

<body>
  <div class="data-analysis"></div>

  <nav class="navbar navbar-expand-sm fixed-top">
    <div class="container">
      <a class="navbar-brand" href="https://dfrieds.com/">Dan<span class="green">_</span>Friedman</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggle-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="nav navbar-nav mr-auto">
        </ul>
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tutorials</a>
              
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="https://dfrieds.com/#math">Math</a>
                <a class="dropdown-item" href="https://dfrieds.com/#data-analysis">Data Analysis with Pandas</a>
                <a class="dropdown-item" href="https://dfrieds.com/#dataviz">Data Visualizations</a>
                <a class="dropdown-item" href="https://dfrieds.com/#python">Python</a>
                <a class="dropdown-item" href="https://dfrieds.com/#ml">Machine Learning</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://dfrieds.com/#articles">Articles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://dfrieds.com/about">About</a>
            </li>
          </ul>
      </div>
    </div>
  </nav>


  <!-- end of header section -->
  <div class="container">

<section id="content" class="body">
  <header>
    <div class="posttype"> 
<!--      -->
    Data Analysis Data Wrangling Tutorial
    <!--   -->
    </div>
    

    <h1 class="articleh1">
      Create Year-Month Column from Dates
    </h1>

    <ul class ="row article_info">
      
      <li>
        Oct 4&nbsp;&nbsp;&bull;&nbsp;&nbsp;5 min read
      </li>
      <li class="tagarticle">
        Key Terms:         datetime,
        python,
        pandas,
        year-month
      </li>
    </ul>
  </header>

  <div class='article_content'>
    <h3>Import Modules</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">random</span>
</pre></div>


<h3>Why Create a Year-Month Numerical Column</h3>
<p>Often times, you'll be asked to create an aggregate metric per month. Can you calculate sales per month? You'll have to create a new column for a year-month combination and then sum sales for each year-month combination. </p>
<p>I recommend calculating year-month in the format of year as a numerical number first and then month as a numerical number. For example, activity in August 2012 should shorten in Python to "2012-8". Why? </p>
<p>This format is appropriate for ordering dates from oldest to newest or newest to oldest. If you format months with an abbreviated name such as "August 2012" and "May 2012", ordering in Python will think "August" comes before "May" which is <em>incorrect</em> by the calendar. See code below that executes to <code>True</code>:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;August 2012&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;May 2012&quot;</span>
</pre></div>


<div class="highlight"><pre><span></span>True
</pre></div>


<p>Also, year must come before month because proper ordering of dates should start with year, then month, day, hour, minute, second, etc. </p>
<p>If we reformat the code above to numbers, the code evaluates to <code>False</code> which is <em>correct</em> because August 2012 does <em>not</em> occur before May 2012.</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;2012-8&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;2012-5&quot;</span>
</pre></div>


<div class="highlight"><pre><span></span>False
</pre></div>


<h3>Example: Calculate User Signups Per Month</h3>
<h4>Create dates</h4>
<p>Let's assume we work for a software as a service (SaaS) business that receives signups for our app. We will create random datetime values in increasing order to represent data for the times people signed up and assign those values to the list <code>signup_datetimes</code>. </p>
<div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
<span class="n">signup_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">signup_datetimes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">total_signups</span> <span class="o">=</span> <span class="mi">60</span>

<span class="k">for</span> <span class="n">signup</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_signups</span><span class="p">):</span>
    <span class="n">random_days</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="n">random_minutes</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">signup_datetime</span> <span class="o">=</span> <span class="n">signup_datetime</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random_days</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">random_minutes</span><span class="p">)</span>
    <span class="n">signup_datetimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signup_datetime</span><span class="p">)</span>
</pre></div>


<p>Create a DataFrame assigned to <code>df</code> with columns for time users signed up and a unique user id value for each signup.</p>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;user_created_at&#39;</span><span class="p">:</span> <span class="n">signup_datetimes</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_signups</span><span class="p">)})</span>
</pre></div>


<p>Preview <code>df</code>.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_created_at</th>
      <th>user_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-10-07 15:11:40.354691</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-10-18 15:40:40.354691</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-10-24 15:56:40.354691</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-10-28 16:28:40.354691</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-11-08 17:00:40.354691</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Create year-month column from date</h4>
<p>Python has a method called <code>strftime()</code> that stands for string format time and can be applied to datetime objects. The method takes as an argument a format for re-formatting a datetime. Popular directives - parts to extract a year, month, etc. are:</p>
<table>
<thead>
<tr>
<th>Directive</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%Y</code></td>
<td>Year with century as a decimal number</td>
</tr>
<tr>
<td><code>%m</code></td>
<td>Month as a decimal number</td>
</tr>
<tr>
<td><code>%d</code></td>
<td>Day of the month as a decimal number</td>
</tr>
<tr>
<td><code>%I</code></td>
<td>Hour (12-hour clock) as a decimal number [01, 12]</td>
</tr>
<tr>
<td><code>%M</code></td>
<td>Minute as a decimal number</td>
</tr>
</tbody>
</table>
<p>Below, I apply the Pandas series <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.strftime.html" target="_blank"><code>strftime()</code> method</a> to the <code>user_created_at</code> datetime column to convert values to the string format of <code>%Y-%m</code>. </p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_created_at_year_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_created_at&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m&#39;</span><span class="p">)</span>
</pre></div>


<p>See all possible pandas string formatting of datetime directives on this <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.strftime.html" target="_blank"> official documentation page</a>.</p>
<p>Preview <code>df</code>.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_created_at</th>
      <th>user_id</th>
      <th>user_created_at_year_month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-10-07 15:11:40.354691</td>
      <td>0</td>
      <td>2019-10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-10-18 15:40:40.354691</td>
      <td>1</td>
      <td>2019-10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-10-24 15:56:40.354691</td>
      <td>2</td>
      <td>2019-10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-10-28 16:28:40.354691</td>
      <td>3</td>
      <td>2019-10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-11-08 17:00:40.354691</td>
      <td>4</td>
      <td>2019-11</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Calculate user signups per month</h4>
<p>I can group by the <code>user_created_at_year_month</code> and count the occurences of unique values using the <a href="https://pandas-docs.github.io/pandas-docs-travis/reference/api/pandas.core.groupby.DataFrameGroupBy.size.html" target="_blank">method below</a> in Pandas. </p>
<p>Then, I cast the resultant Pandas series object to a DataFrame using the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html" target="_blank"><code>reset_index()</code> method</a> and then apply the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html" target="_blank"><code>rename()</code> method</a> to rename the new created column to <code>count_signups</code>.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;user_created_at_year_month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;count_signups&#39;</span><span class="p">})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_created_at_year_month</th>
      <th>count_signups</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-10</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-11</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-12</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020-03</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2020-04</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2020-05</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2020-06</td>
      <td>3</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2020-07</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2020-08</td>
      <td>3</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2020-09</td>
      <td>3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2020-10</td>
      <td>6</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2020-11</td>
      <td>4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2020-12</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<p>Since the dates in <code>df</code> were in order from latest to earliest, we see this same pattern as a result of the group by operation. However, if the original dates were out of order, we could simply order a DataFrame's datetime values with the Pandas <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html" target="_blank"><code>sort_values()</code> method</a></p>
  </div>
</section>

  </div>
  
  <!-- start of footer section -->
  <footer class="footer">
    <div class="container">
      <p class="text-muted">
        <center>Thank you for reading my content! This project is available on <a href="https://github.com/frieds/frieds.github.io">GitHub</a>.
          <br/>
          Copyright &copy; Dan Friedman,
          <time datetime="2019">2019</time>.
        </center>
      </p>
    </div>
  </footer>

  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
  crossorigin="anonymous"></script>

  <!-- This jQuery line finds any span that contains code highlighting classes and then selects the parent <pre> tag and adds a border and background. This is done as a workaround to visually distinguish the code inputs and outputs -->
  <script>
    $( ".hll, .n, .c, .err, .k, .o, .cm, .cp, .c1, .cs, .gd, .ge, .gr, .gh, .gi, .go, .gp, .gs, .gu, .gt, .kc, .kd, .kn, .kp, .kr, .kt, .m, .s, .na, .nb, .nc, .no, .nd, .ni, .ne, .nf, .nl, .nn, .nt, .nv, .ow, .w, .mf, .mh, .mi, .mo, .sb, .sc, .sd, .s2, .se, .sh, .si, .sx, .sr, .s1, .ss, .bp, .vc, .vg, .vi, .il" ).parent( "pre" ).css( "border", "1px solid #038f6d" );
    $( ".hll, .n, .c, .err, .k, .o, .cm, .cp, .c1, .cs, .gd, .ge, .gr, .gh, .gi, .go, .gp, .gs, .gu, .gt, .kc, .kd, .kn, .kp, .kr, .kt, .m, .s, .na, .nb, .nc, .no, .nd, .ni, .ne, .nf, .nl, .nn, .nt, .nv, .ow, .w, .mf, .mh, .mi, .mo, .sb, .sc, .sd, .s2, .se, .sh, .si, .sx, .sr, .s1, .ss, .bp, .vc, .vg, .vi, .il" ).parent( "pre" ).css( "background-color", "#d6eed9" );
  </script>

  <!-- Latest compiled and minified Bootstrap JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="https://dfrieds.com/theme/js/ie10-viewport-bug-workaround.js"></script>
  <!-- <script type="text/javascript">
    $(document).on('click', 'a[href^="#"]', function (event) {
      event.preventDefault();
      $('html, body').animate({
        scrollTop: $($.attr(this, 'href')).offset().top
      }, 500);
    });
  </script> -->

</body>

</html>